(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{646:function(t,s,a){"use strict";a.r(s);var n=a(30),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("以下内容来自《程序员的自我修养》")]),t._v(" "),a("h1",{attrs:{id:"elf-介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elf-介绍"}},[t._v("#")]),t._v(" ELF 介绍")]),t._v(" "),a("p",[t._v("ELF 类型，使用 "),a("code",[t._v("file")]),t._v(" 查看类型：")]),t._v(" "),a("ul",[a("li",[t._v("可重定位文件（relocatable file）：可以被用来链接成可执行文件或共享目标文件，静态链接库也属于这一类（.o, .a）")]),t._v(" "),a("li",[t._v("可执行文件（executable file）")]),t._v(" "),a("li",[t._v("共享目标文件（Shared object file）")]),t._v(" "),a("li",[t._v("核心转储文件（core dump file）")])]),t._v(" "),a("p",[t._v("段分类：")]),t._v(" "),a("ul",[a("li",[t._v(".text 装载了可执行代码")]),t._v(" "),a("li",[t._v(".data 已初始化的全局变量和局部静态变量")]),t._v(" "),a("li",[t._v(".bss (block started by symbol) 未初始化的全局变量和局部静态变量，都为 0，不需要占据空间")]),t._v(" "),a("li",[t._v(".rodata 只读数据段，如字符串常量和 const 变量，比如"),a("code",[t._v('char *x="hello";')]),t._v('，"hello" 放在 rodata，而不是 x')]),t._v(" "),a("li",[t._v(".comment 编译器版本信息")]),t._v(" "),a("li",[t._v(".symtab symbol table")]),t._v(" "),a("li",[t._v(".dynamic 动态链接信息")]),t._v(" "),a("li",[t._v(".plt, .got 动态链接的跳转表和全局入口表")]),t._v(" "),a("li",[t._v(".init, fini 程序初始化与终结代码段")]),t._v(" "),a("li",[t._v(".line 调试时的行号表，即源代码的行号与汇编代码的对应表")]),t._v(" "),a("li",[t._v(".debug 调试信息")])]),t._v(" "),a("p",[t._v("bss 最初是一个伪指令，用于为符号预留一块内存空间")]),t._v(" "),a("p",[t._v("字符串表：存放段名或变量名等，两个字符串之间有 0 隔开，所有字符串可以连续存放，引用时只需要使用表中的偏移")]),t._v(" "),a("ul",[a("li",[t._v(".strtab 存放符号名等")]),t._v(" "),a("li",[t._v(".shstrtab 存放段名 "),a("code",[t._v("sh_name")]),t._v(" 等")]),t._v(" "),a("li",[t._v("变量中引用的字符串常量，比如 "),a("code",[t._v('printf("hello\\n")')]),t._v(" 存放在 rodata")])]),t._v(" "),a("h1",{attrs:{id:"elf-文件解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elf-文件解析"}},[t._v("#")]),t._v(" ELF 文件解析")]),t._v(" "),a("p",[t._v("可以通过 "),a("code",[t._v("man elf")]),t._v(" 查看 ELF 的详细信息")]),t._v(" "),a("p",[t._v("ELF，Executable and Linkable Format，是Unix/Linux系统ABI (Application Binary Interface)规范的一部分")]),t._v(" "),a("blockquote",[a("p",[t._v("ELF 组成（elf.h）：文件开头是 ELF header，接着是 program header 或 section header table 或着两者")])]),t._v(" "),a("p",[t._v("基本类型：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("N=32,64, ElfN 代表 Elf32/Elf64\nElfN_Addr\t\tUnsigned program address, uintN_t\nElfN_Off\t\tUnsigned file offset, uintN_t\nElfN_Section\tUnsigned section index, uint16_t\nElfN_Versym\t\tUnsigned version symbol information, uint16_t\nElf_Byte\t\tunsigned char\nElfN_Half\t\tuint16_t\nElfN_Sword\t\tint32_t\nElfN_Word\t\tuint32_t\nElfN_Sxword\t\tint64_t\nElfN_Xword\t\tuint64_t\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h2",{attrs:{id:"elf-header"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elf-header"}},[t._v("#")]),t._v(" ELF header")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("EI_NIDENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")])])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" e_ident"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("EI_NIDENT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint16_t")]),t._v("\t e_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint16_t")]),t._v("\t e_machine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("\t e_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tElfN_Addr\t e_entry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tElfN_Off\t e_phoff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tElfN_Off\t e_shoff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("\t e_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint16_t")]),t._v("\t e_ehsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint16_t")]),t._v("\t e_phentsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint16_t")]),t._v("\t e_phnum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint16_t")]),t._v("\t e_shentsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint16_t")]),t._v("\t e_shnum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint16_t")]),t._v("\t e_shstrndx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" ElfN_Ehdr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("p",[a("code",[t._v("e_ident")]),t._v("：描述了如何去解析文件，整个数组的值都是宏：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("成员")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("magic(1~4)")]),t._v(" "),a("td",[a("code",[t._v("EI_MAG0")]),t._v("(1)：0x7f；"),a("code",[t._v("EI_MAG1")]),t._v("(2)：'E'；"),a("code",[t._v("EI_MAG2")]),t._v("(3)：'L'；"),a("code",[t._v("EI_MAG3")]),t._v("(4)：'F'")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("EI_CLASS")]),t._v("(5)")]),t._v(" "),a("td",[t._v("描述二进制的架构，"),a("code",[t._v("ELFCLASS32")]),t._v("/"),a("code",[t._v("ELFCLASS64")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("EI_DATA")]),t._v("(6)")]),t._v(" "),a("td",[t._v("字节序，"),a("code",[t._v("ELFDATA2LSB")]),t._v("/"),a("code",[t._v("ELFDATA2MSB")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("EI_VERSION")]),t._v("(7)")]),t._v(" "),a("td",[t._v("ELF 的版本，"),a("code",[t._v("EV_CURRENT")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("EI_OSABI")]),t._v("(8)")]),t._v(" "),a("td",[t._v("表明操作系统和 ABI，"),a("code",[t._v("ELFOSABI_NONE")]),t._v(", "),a("code",[t._v("ELFOSABI_LINUX")]),t._v(", "),a("code",[t._v("ELFOSABI_FREEBSD")]),t._v("...")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("EI_ABIVERSION")]),t._v("(9)")]),t._v(" "),a("td",[t._v("值的意义取决于 "),a("code",[t._v("EI_OSABI")]),t._v("，通常是 0")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("EI_PAD")])]),t._v(" "),a("td",[t._v("剩余都是 0，用于拓展")])])])]),t._v(" "),a("p",[t._v("其他字段意义：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("成员")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("e_type")])]),t._v(" "),a("td",[t._v("文件类型："),a("code",[t._v("ET_REL")]),t._v("(relocatable),"),a("code",[t._v("ET_EXEC")]),t._v("(executable),"),a("code",[t._v("ET_DYN")]),t._v("(shared obj),"),a("code",[t._v("ET_CORE")]),t._v("(core file)")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("e_machine")])]),t._v(" "),a("td",[t._v("硬件架构："),a("code",[t._v("EM_ARM")]),t._v("(Advanced RISC Machines), "),a("code",[t._v("EM_X86_64")]),t._v("(AMD x86-64)...")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("e_entry")])]),t._v(" "),a("td",[t._v("加载程序的虚拟地址")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("e_phoff")])]),t._v(" "),a("td",[t._v("program header table 在文件中的偏移")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("e_shoff")])]),t._v(" "),a("td",[t._v("section header table 在文件中的偏移")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("e_ehsize")])]),t._v(" "),a("td",[t._v("ELF header 的大小")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("e_phentsize")])]),t._v(" "),a("td",[t._v("program header table 的一个 entry 的大小，所有 entry 都是同样的大小")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("e_phnum")])]),t._v(" "),a("td",[t._v("program header table 的 entry 数目")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("e_shentsize")])]),t._v(" "),a("td",[t._v("section header table 的一个 entry 的大小，所有 entry 都是同样的大小")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("e_shnum")])]),t._v(" "),a("td",[t._v("section header table 的 entry 数目")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("e_shstrndx")])]),t._v(" "),a("td",[t._v("shstrtab (段表字符串所在的段) 在段表中的下标")])])])]),t._v(" "),a("p",[t._v("如果 "),a("code",[t._v("e_shnum")]),t._v(" 比 "),a("code",[t._v("SHN_LORESERVE")]),t._v(" (0xff00) 大，值会被保存到第一个 entry 的 "),a("code",[t._v("sh_size")]),t._v("（对于 "),a("code",[t._v("e_phnum")]),t._v(" 是 "),a("code",[t._v("sh_info")]),t._v("）")]),t._v(" "),a("p",[a("code",[t._v(".shstrtab")]),t._v(" 保存了每个 section 的名字，"),a("code",[t._v("e_shstrndx")]),t._v(" 则是 "),a("code",[t._v(".shstrtab")]),t._v(" 在 section header table 的索引位置")]),t._v(" "),a("h2",{attrs:{id:"section-header"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#section-header"}},[t._v("#")]),t._v(" Section header")]),t._v(" "),a("p",[t._v("section header 位置是由 ELF Header 中的 "),a("code",[t._v("e_shoff")]),t._v(" 决定的，数目是 "),a("code",[t._v("e_shnum")])]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   sh_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 存放索引，字符串到 strtab 段中查找")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   sh_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   sh_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tElf32_Addr sh_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tElf32_Off  sh_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   sh_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   sh_link"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   sh_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   sh_addralign"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   sh_entsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" Elf32_Shdr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[t._v("结构中一些的名字已经表示其含义，比较难理解的：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("sh_addralign")]),t._v(" 表示对齐倍数，即 "),a("code",[t._v("sh_addr % (2**sh_addralign)")])]),t._v(" "),a("li",[a("code",[t._v("sh_entsize")]),t._v(" 表示每个项的大小，有些段比如符号表，每个符号的大小是相同的；若为 0，表示不包含固定大小的项")])]),t._v(" "),a("p",[a("code",[t._v("sh_type")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("SHT_PROGBITS")]),t._v("：程序段。代码段和数据段都是该类型")]),t._v(" "),a("li",[a("code",[t._v("SHT_RELA")]),t._v(", "),a("code",[t._v("SHT_REL")]),t._v("：段包含了重定位信息")]),t._v(" "),a("li",[a("code",[t._v("SHT_SYMTAB")]),t._v(", "),a("code",[t._v("SHT_STRTAB")]),t._v(", "),a("code",[t._v("SHT_HASH")]),t._v(", "),a("code",[t._v("SHT_DYNAMIC")]),t._v(", "),a("code",[t._v("SHT_NOTE")])]),t._v(" "),a("li",[a("code",[t._v("SHT_NOBITS")]),t._v("：表示该段在文件中没有内容，如 bss")]),t._v(" "),a("li",[a("code",[t._v("SHT_SHLIB")]),t._v("：保留")]),t._v(" "),a("li",[a("code",[t._v("SHT_DYNSYM")]),t._v("：动态链接符号表")])]),t._v(" "),a("p",[a("code",[t._v("sh_flags")]),t._v(" 值："),a("code",[t._v("SHF_WRITE")]),t._v(" "),a("code",[t._v("SHF_ALLOC")]),t._v(" "),a("code",[t._v("SHF_EXECINSTR")]),t._v(" "),a("code",[t._v("SHF_MASKPROC")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[a("code",[t._v("sh_type")])]),t._v(" "),a("th",[a("code",[t._v("sh_flags")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("bss")]),t._v(" "),a("td",[a("code",[t._v("SHT_NOBITS")])]),t._v(" "),a("td",[a("code",[t._v("SHF_ALLOC")]),t._v(" + "),a("code",[t._v("SHF_WRITE")])])]),t._v(" "),a("tr",[a("td",[t._v("data")]),t._v(" "),a("td",[a("code",[t._v("SHT_PROGBITS")])]),t._v(" "),a("td",[a("code",[t._v("SHF_ALLOC")]),t._v(" + "),a("code",[t._v("SHF_WRITE")])])]),t._v(" "),a("tr",[a("td",[t._v("rodata")]),t._v(" "),a("td",[a("code",[t._v("SHT_PROGBITS")])]),t._v(" "),a("td",[a("code",[t._v("SHF_ALLOC")])])]),t._v(" "),a("tr",[a("td",[t._v("text")]),t._v(" "),a("td",[a("code",[t._v("SHT_PROGBITS")])]),t._v(" "),a("td",[a("code",[t._v("SHF_ALLOC")]),t._v(" + "),a("code",[t._v("SHF_EXECINSTR")])])]),t._v(" "),a("tr",[a("td",[t._v("comment")]),t._v(" "),a("td",[a("code",[t._v("SHT_PROGBITS")])]),t._v(" "),a("td",[t._v("none")])]),t._v(" "),a("tr",[a("td",[t._v("shstrtab")]),t._v(" "),a("td",[a("code",[t._v("SHT_STRTAB")])]),t._v(" "),a("td",[t._v("none")])])])]),t._v(" "),a("p",[a("code",[t._v("sh_link")]),t._v(" 和 "),a("code",[t._v("sh_info")]),t._v(" 值的含义和 "),a("code",[t._v("sh_type")]),t._v(" 有关，需要在链接相关的段，这两个字段才会有意义：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("code",[t._v("sh_type")])]),t._v(" "),a("th",[a("code",[t._v("sh_link")])]),t._v(" "),a("th",[a("code",[t._v("sh_info")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("SHT_DYNAMIC")])]),t._v(" "),a("td",[t._v("该段所用的字符串表在段表中的下标")]),t._v(" "),a("td",[t._v("0")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SHT_HASH")])]),t._v(" "),a("td",[t._v("该段所用的符号表在段表中的下标")]),t._v(" "),a("td",[t._v("0")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SHT_REL")]),t._v("/"),a("code",[t._v("SHT_RELA")])]),t._v(" "),a("td",[t._v("该段所用的相应符号表在段表中的下标")]),t._v(" "),a("td",[t._v("该重定位表所作用的段在段表中的下标")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SHT_SYMTAB")]),t._v("/"),a("code",[t._v("SHT_DYNSYM")])]),t._v(" "),a("td",[t._v("操作系统相关")]),t._v(" "),a("td",[t._v("操作系统相关")])])])]),t._v(" "),a("h2",{attrs:{id:"符号表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#符号表"}},[t._v("#")]),t._v(" 符号表")]),t._v(" "),a("p",[t._v("函数和变量统称符号")]),t._v(" "),a("ul",[a("li",[t._v("函数名和变量名就是符号名")]),t._v(" "),a("li",[t._v("函数和变量的地址就是符号值")]),t._v(" "),a("li",[t._v("符号表就是符号名和符号值的映射表")])]),t._v(" "),a("p",[t._v("符号分类：全局符号，外部符号（extern），段名，局部符号（static），行号信息")]),t._v(" "),a("p",[t._v("符号表通常是文件的一个段，叫做 .symtab，它是一个 "),a("code",[t._v("Elf32_Sym")]),t._v(" 的数组")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("\t  st_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tElf32_Addr\t  st_value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("\t  st_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" st_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("unsigned")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" st_other"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint16_t")]),t._v("\t  st_shndx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" Elf32_Sym"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[t._v("成员")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("st_name")])]),t._v(" "),a("td",[t._v("该符号名在字符串表的下标")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("st_size")])]),t._v(" "),a("td",[t._v("符号对应数据时才有意义，如 double var 是 8bytes")])])])]),t._v(" "),a("p",[a("code",[t._v("st_info")]),t._v(" 的低 4 位表示符号类型，高 28 位表示符号绑定信息")]),t._v(" "),a("ul",[a("li",[t._v("符号类型："),a("code",[t._v("STT_OBJECT")]),t._v("（数据对象，如变量、数组）, "),a("code",[t._v("STT_FUNC")]),t._v(", "),a("code",[t._v("STT_SECTION")]),t._v(", "),a("code",[t._v("STT_FILE")]),t._v("(该符号表示文件名)")]),t._v(" "),a("li",[t._v("绑定信息："),a("code",[t._v("STB_LOCAL")]),t._v("(static), "),a("code",[t._v("STB_GLOBAL")]),t._v(", "),a("code",[t._v("STB_WEAK")])])]),t._v(" "),a("p",[a("code",[t._v("st_shndx")]),t._v(" 符号所在段，如果符号在本文件中，则该值表示符号所在段在段表中的下标，否则如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("宏名")]),t._v(" "),a("th",[t._v("值")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("SHN_ABS")])]),t._v(" "),a("td",[t._v("0xfff1")]),t._v(" "),a("td",[t._v("该符号包含了一个绝对值，比如文件名的符号")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SHN_COMMON")])]),t._v(" "),a("td",[t._v("0xfff2")]),t._v(" "),a("td",[t._v("该符号是 COMMON 块符号，比如未初始化的全局符号")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("SHN_UNDEF")])]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("该符号在本文件中被引用，但是定义在其他文件中")])])])]),t._v(" "),a("p",[a("code",[t._v("st_value")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("在目标文件中，若为符号定义且不是 "),a("code",[t._v("SHN_COMMON")]),t._v("，"),a("code",[t._v("st_value")]),t._v(" 表示该符号在段中的偏移")]),t._v(" "),a("li",[t._v("在目标文件中，若为 "),a("code",[t._v("SHN_COMMON")]),t._v("，"),a("code",[t._v("st_value")]),t._v(" 表示符号的对其属性")]),t._v(" "),a("li",[t._v("在可执行文件中，"),a("code",[t._v("st_value")]),t._v(" 表示符号的虚拟地址")])]),t._v(" "),a("p",[t._v("特殊符号（ld 产生可执行文件后才会出现）")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("__etext")]),t._v(" 或 "),a("code",[t._v("_etext")]),t._v(" 或 "),a("code",[t._v("etext")]),t._v("：符号为代码段结束地址")]),t._v(" "),a("li",[a("code",[t._v("_edata")]),t._v(" 或 "),a("code",[t._v("edata")]),t._v("：符号为数据段结束地址")]),t._v(" "),a("li",[a("code",[t._v("_end")]),t._v(" 或 "),a("code",[t._v("end")]),t._v("：符号为程序结束地址")])]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打印特殊符号地址")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extern")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" __etext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extern")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" _edata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%p\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __etext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%p\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _edata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("h3",{attrs:{id:"符号修饰与函数签名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#符号修饰与函数签名"}},[t._v("#")]),t._v(" 符号修饰与函数签名")]),t._v(" "),a("p",[t._v("c++ 的重载以及命名空间，解决方法是符号修饰；"),a("strong",[t._v("函数签名")]),t._v("：包含了一个函数的信息，包括函数名，参数类型、所在的类和名称空间；变量也采用类似方式")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("函数签名")]),t._v(" "),a("th",[t._v("修饰后的名称（符号名）")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("int func(int)")]),t._v(" "),a("td",[a("code",[t._v("_Z4funci")])])]),t._v(" "),a("tr",[a("td",[t._v("float func(float)")]),t._v(" "),a("td",[a("code",[t._v("_Z4funcf")])])]),t._v(" "),a("tr",[a("td",[t._v("int C::func(int)")]),t._v(" "),a("td",[a("code",[t._v("_ZN1C4funcEi")])])]),t._v(" "),a("tr",[a("td",[t._v("int C::C2::func(int)")]),t._v(" "),a("td",[a("code",[t._v("_ZN1C2C24funcEi")])])]),t._v(" "),a("tr",[a("td",[t._v("int N::func(int)")]),t._v(" "),a("td",[a("code",[t._v("_ZN1N4funcEi")])])]),t._v(" "),a("tr",[a("td",[t._v("int N::C::func(int)")]),t._v(" "),a("td",[a("code",[t._v("_ZN1N1C4funcEi")])])])])]),t._v(" "),a("p",[a("code",[t._v('extern "C"')]),t._v("：将大括号内的代码当作 c 处理，因此 C++ 的名称修饰机制将不起作用，这样编译后的符号才能成功链接 C 库")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("ifdef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("__cplusplus")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extern")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("endif")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无 extern c，c++ 得到符号为 _Z6memsetPvii")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// c 得到的符号为 memset")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("memset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("size_t")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("ifdef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("__cplusplus")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("endif")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h1",{attrs:{id:"静态链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态链接"}},[t._v("#")]),t._v(" 静态链接")]),t._v(" "),a("p",[t._v("VMA (Virtual Memory Address) 和 LMA (Load Memory Address) 正常情况下是一样的；程序存放到 ROM 时，LMA 和 VMA 是不同")]),t._v(" "),a("p",[t._v("将两个文件链接，并查看 VMA：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ objdump -h a.o\nIdx Name\t\t  Size\t\tVMA\t\t\t\t  LMA\t\t\t\tFile off  Algn\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" .text\t\t  000000e0\t0000000000000000  0000000000000000\t00000040  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("**0\n\t\t\t\t  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -e 指定程序入口")]),t._v("\n$ ld a.o b.o -e main -o ab\n$ readelf -h a\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" .text\t\t  00000245\t0000000000001080  0000000000001080\t00001080  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("**4\n\t\t\t\t  CONTENTS, ALLOC, LOAD, READONLY, CODE\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[t._v("链接前，VMA 是 0，链接后 VMA 才有值，链接主要完成了两个工作：")]),t._v(" "),a("ol",[a("li",[t._v("空间和地址分配：扫描所有输入的目标文件，根据所有段的长度、属性、位置，将其合并起来")]),t._v(" "),a("li",[t._v("符号解析和重定位")])]),t._v(" "),a("p",[t._v("链接前后符号引用地址对比：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 链接前，符号引用处的地址")]),t._v("\n$ objdump -d a.o\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("34")]),t._v(":\t8b 05 00 00 00 00\t\tmov    0x0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("%rip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",%eax\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3a <test_address+0x3a>")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 链接后，符号引用处的地址: 0x2e95 + 0x11c3 = 0x4058")]),t._v("\n$ objdump -d a\n  11bd:\t\t  8b 05 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v(" 2e 00 00\t\t  mov\t 0x2e95"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("%rip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",%eax\t\t  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4058 <i>")]),t._v("\n  11c3:\t\t  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("89")]),t._v(" c6\t\t\t\t\t  mov\t %eax,%esi\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 链接后数据段")]),t._v("\n$ objdump -r a\nContents of section .data:\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4048")]),t._v(" 00000000 00000000 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50400000")]),t._v(" 00000000  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("P@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4058")]),t._v(" 05000000\t\t\t\t\t\t\t   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("h2",{attrs:{id:"符号解析与重定位"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#符号解析与重定位"}},[t._v("#")]),t._v(" 符号解析与重定位")]),t._v(" "),a("p",[t._v("重定位主要依靠重定位表，被放在 .rela.text（"),a("code",[t._v("Elf32_Shdr->sh_type")]),t._v(" 为 "),a("code",[t._v("SHT_RELA")]),t._v("）；该表是一个 "),a("code",[t._v("Elf32_Rel")]),t._v(" 数组，数组的每个元素叫做重定位入口（Relocation Entry）")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tElf32_Addr r_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   r_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" Elf32_Rel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("ul",[a("li",[a("code",[t._v("r_offset")]),t._v("：该重定位入口所要修正的位置的第一个字节的虚拟地址")]),t._v(" "),a("li",[a("code",[t._v("r_info")]),t._v("：\n"),a("ul",[a("li",[t._v("低 8 位表示重定位入口的类型，该类型是 processor-specific")]),t._v(" "),a("li",[t._v("高 24 位表示重定位入口的符号在符号表的下标")])])])]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 读取符号表")]),t._v("\n$ readelf -r a.o\n  Offset\t\t  Info\t\t\t Type\t\t\tSym. Value\t  Sym. Name + Addend\n000000000036  000a00000002 R_X86_64_PC32\t 0000000000000000 i - "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("ul",[a("li",[t._v("指令修正方式是根据 "),a("code",[t._v("Elf32_Rel.r_info")]),t._v(" 的类型")]),t._v(" "),a("li",[t._v("类型若是 "),a("code",[t._v("R_X86_64_PC32")]),t._v(" 或 "),a("code",[t._v("R_X86_64_PLT32")]),t._v("，使用的是相对寻址，即 "),a("code",[t._v("%rip")])])]),t._v(" "),a("p",[t._v("比如在前面的例子中，变量 i 是 "),a("code",[t._v("R_X86_64_PC32")]),t._v(" 类型：")]),t._v(" "),a("ul",[a("li",[t._v("符号链接后在可执行文件的位置，即 0x4058")]),t._v(" "),a("li",[a("code",[t._v("%rip")]),t._v(" 为下一条指令的地址 0x11c3")]),t._v(" "),a("li",[t._v("最终可以得到修正的值为 0x4058 - 0x11c3 = 0x2e95")])]),t._v(" "),a("p",[t._v("注意 .rela.text 是不会输出到最终的可执行文件")]),t._v(" "),a("h2",{attrs:{id:"common"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#common"}},[t._v("#")]),t._v(" COMMON")]),t._v(" "),a("p",[t._v("COMMON 块，即 "),a("code",[t._v("Elf32_Sym.st_shndx")]),t._v(" 为 "),a("code",[t._v("SHN_COMMON")])]),t._v(" "),a("ul",[a("li",[t._v("COMMON 为未初始化的全局变量；未初始化的局部变量（即 static）的 "),a("code",[t._v("st_shndx")]),t._v(" 为对应段的下标；extern 变量为 "),a("code",[t._v("SHN_UNDEF")])]),t._v(" "),a("li",[t._v("COMMON 的链接规则是针对弱符号的情况：\n"),a("ul",[a("li",[t._v("符号类型不同，即其他 obj 有一个占用空间更大的符号，该符号会覆盖更小的弱符号")]),t._v(" "),a("li",[t._v("符号类型相同，即其他 obj 若有已初始化的全局变量，即强符号，则采用强符号")])])])]),t._v(" "),a("p",[t._v("编译时可以加入 "),a("code",[t._v("-fno-common")]),t._v(" 来禁用 COMMON，或单个变量以 "),a("code",[t._v("__attribute__((nocommon))")]),t._v(" 来禁用\n若一个符号不是以 COMMON 存在，则其为强符号，链接是会有符号重复定义的错误")]),t._v(" "),a("h2",{attrs:{id:"c-相关问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#c-相关问题"}},[t._v("#")]),t._v(" C++ 相关问题")]),t._v(" "),a("p",[t._v("如果消除 c++ 的函数模板生成的重复代码：")]),t._v(" "),a("ul",[a("li",[t._v("空间浪费")]),t._v(" "),a("li",[t._v("还会导致 icache 缓存了大量的重复代码，cache 命中率降低")]),t._v(" "),a("li",[t._v("地址容易出错：可能指向同一个函数的地址不同")])]),t._v(" "),a("p",[t._v("消除方法：每个模板的实例代码都单独放到一个段里，每个段只包含一个模板实例；比如 "),a("code",[t._v("add<T>()")]),t._v("，生成两个段，名字分别为 "),a("code",[t._v(".temp.add<int>")]),t._v(" 和 "),a("code",[t._v(".temp.add<float>")]),t._v("，链接器最终将相同段合并到代码段中")]),t._v(" "),a("blockquote",[a("p",[t._v("函数级别链接（Functional-leveling linking）是 vc++ 的一个编译选项：类似函数模板的段，让所有函数单独保存到一个段，当链接器用到某个函数，将其合并到输出文件中，舍弃没有用的函数")])]),t._v(" "),a("p",[t._v("GCC 的类似选项是 "),a("code",[t._v("-ffunction-sections")]),t._v("/"),a("code",[t._v("-fdata-sections")]),t._v("：将函数或变量保存到独立的段中；同时链接器还需要打开 "),a("code",[t._v("--gc-sections")]),t._v(" 才会去除无用函数")]),t._v(" "),a("h1",{attrs:{id:"动态装载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态装载"}},[t._v("#")]),t._v(" 动态装载")]),t._v(" "),a("p",[t._v("执行可执行文件步骤：")]),t._v(" "),a("ul",[a("li",[t._v("创建一个独立的虚拟地址空间：对于 linux 只是分配一个页目录")]),t._v(" "),a("li",[t._v("读取可执行文件头，建立虚拟空间与可执行文件的映射关系")]),t._v(" "),a("li",[t._v("将 CPU 的指令寄存器设置为可执行文件的入口地址，启动运行")])]),t._v(" "),a("p",[t._v("虚拟空间与可执行文件的映射关系保存在内核的一个数据结构中；虚拟空间中的一个段（Segment）叫做 VMA；多个相同权限的 section 可能合并到一个 segment，从而减小内存碎片")]),t._v(" "),a("p",[t._v("section 权限分类：")]),t._v(" "),a("ul",[a("li",[t._v("text：可读可执行")]),t._v(" "),a("li",[t._v("data, bss：可读可写")]),t._v(" "),a("li",[t._v("rodata：只读")])]),t._v(" "),a("p",[t._v("查看进程的各个 segments：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /proc/PID/\n5596482cd000-5596482ce000 r--p 00000000 08:02 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9055330")]),t._v("\t  /home/ye/github/debug_learn/ElfHacks/backtrace/a\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n5596482ee000-55964830f000 rw-p 00000000 00:00 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\t\t\t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("heap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n7f9e851ba000-7f9e851bb000 r--p 00017000 08:02 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1577050")]),t._v("\t  /usr/lib/libgcc_s.so.1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nf9e8537c000-7f9e8537f000 rw-p 001bf000 08:02 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1576280")]),t._v("\t  /usr/lib/libc-2.30.so\n7f9e853b0000-7f9e853b2000 r--p 00000000 08:02 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1576261")]),t._v("\t  /usr/lib/ld-2.30.so\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n7f9e853dc000-7f9e853dd000 rw-p 00000000 00:00 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n7ffc49937000-7ffc49958000 rw-p 00000000 00:00 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\t\t\t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("stack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n7ffc499cf000-7ffc499d2000 r--p 00000000 00:00 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\t\t\t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("vvar"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n7ffc499d2000-7ffc499d3000 r-xp 00000000 00:00 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\t\t\t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("vdso"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nffffffffff600000-ffffffffff601000 --xp 00000000 00:00 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\t  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("vsyscall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("h2",{attrs:{id:"program-header"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#program-header"}},[t._v("#")]),t._v(" Program header")]),t._v(" "),a("p",[t._v("program header table 是 "),a("code",[t._v("Elf32_Phdr")]),t._v(" 数组，它保存了 segment 的信息")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   p_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tElf32_Off  p_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tElf32_Addr p_vaddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tElf32_Addr p_paddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   p_filesz"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   p_memsz"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   p_flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v("   p_align"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" Elf32_Phdr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("ul",[a("li",[a("code",[t._v("p_type")]),t._v("：指明了 segment 的类型\n"),a("ul",[a("li",[a("code",[t._v("PT_LOAD")]),t._v("：segment 是 loadable")]),t._v(" "),a("li",[a("code",[t._v("PT_DYNAMIC")]),t._v("：segment 含有动态链接的信息")])])]),t._v(" "),a("li",[a("code",[t._v("p_vaddr")]),t._v("：segment 的第一个字节在进程虚拟空间地址的其实位置，在程序头表，LOAD 类型程序头按 "),a("code",[t._v("p_vaddr")]),t._v(" 从小到大排列")]),t._v(" "),a("li",[a("code",[t._v("p_paddr")]),t._v("：segment 的物理装载地址，即 LMA")]),t._v(" "),a("li",[a("code",[t._v("p_filesz")]),t._v("：segment 在 ELF 文件中的长度，可能为 0")]),t._v(" "),a("li",[a("code",[t._v("p_memsz")]),t._v("：segment 在 VMA 中的长度，可能为 0")]),t._v(" "),a("li",[a("code",[t._v("p_flags")]),t._v("：segment 的权限属性，"),a("code",[t._v("PF_X")]),t._v("(可执行), "),a("code",[t._v("PF_W")]),t._v("(可写), "),a("code",[t._v("PF_R")]),t._v("(可读)")]),t._v(" "),a("li",[a("code",[t._v("p_align")]),t._v("：在文件和内存中 segment 的对齐字节数（"),a("code",[t._v("2**p_align")]),t._v("）")])]),t._v(" "),a("p",[t._v("对于 "),a("code",[t._v("PT_LOAD")]),t._v(" 的 segment，"),a("code",[t._v("p_memsz")]),t._v(" 不可以小于 "),a("code",[t._v("p_filesz")]),t._v("，多出的部分全部填 0，多出的部分是 bss，这样就无需再为 bss 设置 segment")]),t._v(" "),a("h1",{attrs:{id:"动态链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态链接"}},[t._v("#")]),t._v(" 动态链接")]),t._v(" "),a("p",[t._v("从之前的内存映射可以知道，虚拟地址映射了 libc.so、ld.so，在运行程序前，控制权先交给动态链接器")]),t._v(" "),a("p",[t._v("装载时重定位：")]),t._v(" "),a("ul",[a("li",[t._v("在没有虚拟内存时，程序直接加载到物理内存，所以程序被装载的地址是不确定的，因此系统需要在装载时对指令和数据对绝对地址的引用进行重定位")]),t._v(" "),a("li",[t._v("程序中指令和数据的相对位置不会变化：比如编译时假设装载目标的地址是 0x1000，系统发现 0x1000 已被使用，0x4000 有足够空间，指令中所有绝对引用加上 0x3000 的偏移即可")])]),t._v(" "),a("p",[t._v("GCC 有两个参数 "),a("code",[t._v("-shared")]),t._v(" 和 "),a("code",[t._v("-fPIC")]),t._v("，若只使用 "),a("code",[t._v("-shared")]),t._v("，那么输出的共享对象就是使用装载时重定位的方法")]),t._v(" "),a("h2",{attrs:{id:"地址无关代码-position-independent-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#地址无关代码-position-independent-code"}},[t._v("#")]),t._v(" 地址无关代码（Position-independent Code）")]),t._v(" "),a("p",[t._v("装载时重定位缺点：绝对地址的引用导致共享对象的指令部分无法在多个进程间共享，浪费内存")]),t._v(" "),a("p",[t._v("4 种类型的地址引用方式：")]),t._v(" "),a("ul",[a("li",[t._v("模块内部的函数调用、跳转：使用相对地址调用，或者基于寄存器的相对调用")]),t._v(" "),a("li",[t._v("模块内部数据访问，比如全局变量、静态变量：通常使用 rip 寄存器，rip 保存了当前指令的地址")]),t._v(" "),a("li",[t._v("模块间数据访问：在数据段建立一个指向这些变量的指针数组，称为全局偏移表（Global Offset Table, GOT）")]),t._v(" "),a("li",[t._v("模块间调用、跳转：plt")])]),t._v(" "),a("p",[t._v("链接器会在装载时查找变量所在的地址，填充 GOT 的各个项，保证 GOT 指向的地址正确")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# static void b_inner(void)，模块内函数调用\n1119: callq  1109 <b_inner>\n\n# int a，模块内数据访问\n112a: movl\t $0x2,0x2ef8(%rip) # 402c <a>\n\n# extern int c，模块间数据访问\n1134: mov\t 0x2ead(%rip),%rax # 3fe8 <c>\n113b: movl\t $0x2,(%rax)\n\n# 对应 section\nContents of section .got:\n 3fd8 00000000 00000000 00000000 00000000  ................\n 3fe8 00000000 00000000 00000000 00000000  ................\n 3ff8 00000000 00000000\t\t\t\t\t   ........\nContents of section .data:\n 4020 20400000 00000000\t\t\t\t\t\t@......\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("h2",{attrs:{id:"延迟绑定-plt-procedure-linkage-table"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#延迟绑定-plt-procedure-linkage-table"}},[t._v("#")]),t._v(" 延迟绑定（PLT, Procedure Linkage Table）")]),t._v(" "),a("p",[t._v("模块使用了大量函数引用，如果程序执行前就进行动态链接，必定拖慢程序的初始化，因此 ELF 采用了延迟绑定，即函数第一次用到时才进行绑定")]),t._v(" "),a("p",[t._v("比如第一次调用 printf()，需要知道地址绑定在哪个模块，哪个函数？将这两个答案作为参数传递给动态链接器的 "),a("code",[t._v("_dl_runtime_resolve()")]),t._v("，让该函数完成延迟绑定")]),t._v(" "),a("p",[t._v("PLT 比 GOT 又增加了一层间接跳转，调用函数通过一个 PLT 项进行跳转，每个外部函数都有一个对应的 PLT 项：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("0000000000001020 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(".plt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1020")]),t._v(": pushq\t0x2fe2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("%rip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4008 <_GLOBAL_OFFSET_TABLE_+0x8>")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1026")]),t._v(": jmpq\t\t*0x2fe4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("%rip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4010 <_GLOBAL_OFFSET_TABLE_+0x10>")]),t._v("\n 102c: nopl\t\t0x0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("%rax"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n0000000000001070 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("printf@plt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1070")]),t._v(": jmpq\t\t*0x2fc2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("%rip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4038 <printf@GLIBC_2.2.5>")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1076")]),t._v(": pushq\t"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$0x4")]),t._v("\n 107b: jmpq\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1020")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(".plt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n0000000000001231 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1259")]),t._v(": callq\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1070")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("printf@plt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# objdump -s a")]),t._v("\nContents of section .dynamic:\n 3de8 01000000 00000000 01000000 00000000  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\nContents of section .got.plt:\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),t._v(" f83d0000 00000000 00000000 00000000  ."),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4010")]),t._v(" 00000000 00000000 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("36100000")]),t._v(" 00000000  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4020")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("46100000")]),t._v(" 00000000 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("56100000")]),t._v(" 00000000  F"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".V"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4040")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("86100000")]),t._v(" 00000000 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("96100000")]),t._v(" 00000000  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br")])]),a("p",[a("code",[t._v("printf@plt")])]),t._v(" "),a("ul",[a("li",[t._v("第一条指令是 .got.plt 的间接跳转，如果 ld 已经将地址填入该项，则是直接跳转 printf")]),t._v(" "),a("li",[t._v("第二条指令 push 的值是 printf 符号在重定位表 .rel.plt 的下标")]),t._v(" "),a("li",[t._v("第三条指令是跳转 "),a("code",[t._v("_dl_runtime_resolve()")])])]),t._v(" "),a("p",[t._v("ELF 将 GOT 分成了两个表 .got 和 .got.plt，前者保存全局变量引用的地址，后者保存函数引用的地址")]),t._v(" "),a("p",[t._v(".got.plt（类似 .got）前 3 项是特殊的：")]),t._v(" "),a("ul",[a("li",[t._v("第 1 项是 .dynamic 段的地址")]),t._v(" "),a("li",[t._v("第 2 项是本模块的 ID")]),t._v(" "),a("li",[t._v("第 3 项是 "),a("code",[t._v("_dl_runtime_resolve()")]),t._v(" 的地址")])]),t._v(" "),a("h2",{attrs:{id:"动态链接相关结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态链接相关结构"}},[t._v("#")]),t._v(" 动态链接相关结构")]),t._v(" "),a("p",[t._v("动态链接器的路径是由 .interp 段（interpreter）决定的：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ objdump -s a\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nContents of section .interp:\n 02a8 2f6c6962 36342f6c 642d6c69 6e75782d  /lib64/ld-linux-\n 02b8 7838362d 36342e73 6f2e3200\t\t   x86-64.so.2.\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v(".dynamic 段保存了动态链接器需要的基本信息：比如依赖哪些共享对象、动态链接符号表的位置、动态链接重定位表的位置、共享对象初始化代码的地址；该段的结构是一个 "),a("code",[t._v("Elf32_Dyn")]),t._v(" 数组：")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tElf32_Sword    d_tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("union")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tElf32_Word d_val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tElf32_Addr d_ptr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" d_un"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" Elf32_Dyn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[a("code",[t._v("d_tag")]),t._v(" 类型")]),t._v(" "),a("th",[a("code",[t._v("d_un")]),t._v(" 含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("DT_SYMTAB")])]),t._v(" "),a("td",[t._v("动态链接符号表地址，"),a("code",[t._v("d_ptr")]),t._v(" 表示 .dynsym 地址")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DT_STRTAB")])]),t._v(" "),a("td",[t._v("动态链接字符串表地址，"),a("code",[t._v("d_ptr")]),t._v(" 表示 .dynstr 地址")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DT_STRSZ")])]),t._v(" "),a("td",[t._v("动态里链接字符串表大小，"),a("code",[t._v("d_val")]),t._v(" 表示大小")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DT_HASH")])]),t._v(" "),a("td",[t._v("动态链接哈希表地址，"),a("code",[t._v("d_ptr")]),t._v(" 表示 .hash 大小")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DT_SONAME")])]),t._v(" "),a("td",[t._v("本共享对象的 SO-NAME")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DT_RPATH")])]),t._v(" "),a("td",[t._v("动态链接共享对象的搜索路径")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DT_INIT")])]),t._v(" "),a("td",[t._v("初始化代码地址")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DT_FINI")])]),t._v(" "),a("td",[t._v("结束代码地址")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DT_NEEDED")])]),t._v(" "),a("td",[t._v("依赖共享对象文件名，"),a("code",[t._v("d_ptr")]),t._v(" 是其在 .dynstr 中的偏移")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DT_REL")]),t._v("/"),a("code",[t._v("DT_RELA")])]),t._v(" "),a("td",[t._v("动态链接重定位表地址")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("DT_RELENT")]),t._v("/"),a("code",[t._v("DT_RELAENT")])]),t._v(" "),a("td",[t._v("动态重读位表入口数量")])])])]),t._v(" "),a("p",[a("strong",[t._v("动态符号表")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("与静态链接的 .symtab 类似，动态链接用到了 .dynsym；注意，前者包含了所有符号，包括 .dynsym，后者只包含动态符号")]),t._v(" "),a("li",[t._v(".dynsym 的辅助字符串表 .dynstr（类似 .symtab 对应的 .strtab）；同时为了加速查找，还有 .hash")])]),t._v(" "),a("p",[a("strong",[t._v("动态链接重定位表")]),t._v("（类似 .rela.data 和 .rela.text）")]),t._v(" "),a("ul",[a("li",[t._v(".rela.dyn 修正的是 .got")]),t._v(" "),a("li",[t._v(".rela.plt 修正的是 .got.plt")])]),t._v(" "),a("p",[t._v("动态链接重定位表也是 "),a("code",[t._v("Elf32_Rel")]),t._v(" 数组，"),a("code",[t._v("Elf32_Rel->r_info")]),t._v(" 的低 8 位，即类型变为以下值：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("R_X86_64_RELATIVE")])]),t._v(" "),a("li",[a("code",[t._v("R_X86_64_GLOB_DAT")])]),t._v(" "),a("li",[a("code",[t._v("R_X86_64_JUMP_SLO")])])]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ readelf -r a\nRelocation section "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.rela.dyn'")]),t._v(" at offset 0x588 contains "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" entries:\n  Offset\t\t  Info\t\t\t Type\t\t\tSym. Value\t  Sym. Name + Addend\n000000003dd8  000000000008 R_X86_64_RELATIVE\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1190")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .init_array")]),t._v("\n000000003de0  000000000008 R_X86_64_RELATIVE\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1140")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .fini_array")]),t._v("\n000000004058  000000000008 R_X86_64_RELATIVE\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4058")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .data")]),t._v("\n000000003fe0  000800000006 R_X86_64_GLOB_DAT 0000000000000000 __libc_start_main@GLIBC_2.2.5 + "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nRelocation section "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.rela.plt'")]),t._v(" at offset 0x648 contains "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" entries:\n  Offset\t\t  Info\t\t\t Type\t\t\tSym. Value\t  Sym. Name + Addend\n000000004038  000600000007 R_X86_64_JUMP_SLO 0000000000000000 printf@GLIBC_2.2.5 + "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("ld 还需要知道可执行文件和本进程的其他一些信息：比如有几个 segment、每个 segment 的属性、程序的入口地址，这些信息通过栈传递给 ld，栈里面保存了辅助信息数组（Auxiliary Vector）")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v(" a_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("union")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("uint32_t")]),t._v(" a_val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" a_un"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" Elf32_auxv_t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[a("code",[t._v("a_type")])]),t._v(" "),a("th",[a("code",[t._v("a_val")]),t._v(" 含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("AT_NULL")])]),t._v(" "),a("td",[t._v("辅助信息数组结束")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("AT_EXECFD")])]),t._v(" "),a("td",[t._v("表示可执行文件的 fd")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("AT_PHDR")])]),t._v(" "),a("td",[t._v("program header 在进程中的地址")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("AT_PHENT")])]),t._v(" "),a("td",[t._v("program header 中每一个 entry 的大小")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("AT_PHNUM")])]),t._v(" "),a("td",[t._v("program header 的 entry 的数量")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("AT_BASE")])]),t._v(" "),a("td",[t._v("动态链接器本身的装载地址")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("AT_ENTRY")])]),t._v(" "),a("td",[t._v("可执行文件入口地址，即启动地址")])])])]),t._v(" "),a("p",[t._v("辅助信息数组在栈中的位置：环境变量指针的前面")]),t._v(" "),a("h2",{attrs:{id:"动态链接的步骤和实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态链接的步骤和实现"}},[t._v("#")]),t._v(" 动态链接的步骤和实现")]),t._v(" "),a("ol",[a("li",[t._v("动态链接器自举（bootstrap）：由于还没有填充好 GOT，这阶段不能使用全局变量\n"),a("ul",[a("li",[t._v("自举首先找到 ld 的 GOT (.got, .got.plt)，第一项就是 .dynamic 的偏移")]),t._v(" "),a("li",[t._v("通过 .dynamic 获取 ld 的 .rela.plt 和 .dynsym")]),t._v(" "),a("li",[t._v("对 .rela.dyn 的符号进行重定位，填写 .got")])])]),t._v(" "),a("li",[t._v("装载共享对象：加载 .dynamic 中类型为 "),a("code",[t._v("DT_NEEDED")]),t._v(" 的共享对象，并将其代码段和数据段映射到进程空间")]),t._v(" "),a("li",[t._v("重定位和初始化：\n"),a("ul",[a("li",[t._v("根据 rela.dyn 以及 .rela.plt，修正每个共享对象的 .got 和 .got.plt")]),t._v(" "),a("li",[t._v("执行共享对象的 .init 段")])])])]),t._v(" "),a("p",[t._v("动态链接器：是一个共享对象，还是一个可执行文件")]),t._v(" "),a("ul",[a("li",[t._v("对于静态链接的可执行文件，程序的入口就是 ELF header 的 "),a("code",[t._v("e_entry")]),t._v(" 指定的入口")]),t._v(" "),a("li",[t._v("对于动态链接的可执行文件，内核先会分析 .interp 段，再将控制权交给 ld")]),t._v(" "),a("li",[t._v("内核没有分析 elf header 中的 "),a("code",[t._v("e_type")]),t._v(" 是 "),a("code",[t._v("ET_EXEC")]),t._v(" 还是 "),a("code",[t._v("ET_DYN")]),t._v("，因此 ld 可执行")])]),t._v(" "),a("h2",{attrs:{id:"显式运行时链接-explicit-run-time-linking"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#显式运行时链接-explicit-run-time-linking"}},[t._v("#")]),t._v(" 显式运行时链接（Explicit Run-time linking）")]),t._v(" "),a("p",[t._v("让程序运行时加载指定的模块，在不需要时卸载模块，可以利用 ld 提供的 4 个 API：")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* link with -ldl */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("<dlfcn.h>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlopen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlsym")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("handle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("symbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlerror")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlclose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("handle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 另一个接口 */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("_GNU_SOURCE")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlmopen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Lmid_t lmid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" flags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlvsym")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("handle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("symbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[a("code",[t._v("dlopen()")])]),t._v(" "),a("ul",[a("li",[t._v("filename：可以是相对路径，按照动态库搜索路径规则")]),t._v(" "),a("li",[t._v("flag：\n"),a("ul",[a("li",[a("code",[t._v("RTLD_LAZY")]),t._v(" 表示使用 PLT，无法捕获错误")]),t._v(" "),a("li",[a("code",[t._v("RTLD_NOW")]),t._v(" 表示立即进行函数绑定，若有符号未能绑定，"),a("code",[t._v("dlerror()")]),t._v(" 可以捕获错误")]),t._v(" "),a("li",[a("code",[t._v("RTLD_GLOBAL")]),t._v(" 可以跟前 2 个一起使用，表示加载模块的全局符号表合并到进程全局符号表")])])]),t._v(" "),a("li",[t._v("返回 handle 指针")])]),t._v(" "),a("p",[a("code",[t._v("dlsym()")]),t._v(" 找到符号，返回函数或变量的地址，若是常量，返回其值；对于常量为 NULL 或 0，可以使用 "),a("code",[t._v("dlerror()")]),t._v(" 是否返回 NULL 来判断")]),t._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* cc dlopen_demo.c -ldl */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("handle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("cosine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\thandle "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlopen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LIBM_SO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" RTLD_LAZY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("handle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EXIT_FAILURE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlerror")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* Clear any existing error */")]),t._v("\n\n\tcosine "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlsym")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cos"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\terror "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlerror")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EXIT_FAILURE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%f\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("cosine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dlclose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EXIT_SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);